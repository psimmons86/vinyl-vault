<%- include('../partials/header.ejs') %>

<div class="form-container">
    <div class="form-header">
        <h2>Add New Record</h2>
        <p>Add details about your vinyl record</p>
    </div>

    <form action="/records" method="POST" class="record-form">
        <div class="form-grid">
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" 
                       name="title" 
                       id="title" 
                       value="<%= prefilledData ? prefilledData.title : '' %>"
                       required>
            </div>

            <div class="form-group">
                <label for="artist">Artist</label>
                <input type="text" 
                       name="artist" 
                       id="artist" 
                       value="<%= prefilledData ? prefilledData.artist : '' %>"
                       required>
            </div>

            <div class="form-group">
                <label for="year">Year</label>
                <input type="number" 
                       name="year" 
                       id="year" 
                       value="<%= prefilledData ? prefilledData.year : '' %>">
            </div>

            <div class="form-group">
                <label for="format">Format</label>
                <select name="format" id="format">
                    <% formats.forEach(format => { %>
                        <option value="<%= format %>"
                                <%= (prefilledData && prefilledData.format === format) ? 'selected' : '' %>>
                            <%= format %>
                        </option>
                    <% }); %>
                </select>
            </div>

            <div class="form-group full-width">
                <label for="imageUrl">Album Art URL</label>
                <input type="url" 
                       name="imageUrl" 
                       id="imageUrl"
                       value="<%= prefilledData ? prefilledData.imageUrl : '' %>">
                <div id="imagePreview" class="image-preview">
                    <img src="/images/default-album.png" alt="Album preview">
                </div>
            </div>

            <div class="form-group full-width">
                <label for="tags">Tags (comma separated)</label>
                <input type="text" 
                       id="tags" 
                       name="tags" 
                       value="<%= prefilledData ? prefilledData.tags : '' %>"
                       placeholder="e.g., jazz, 1970s, live">
            </div>

            <div class="form-group full-width">
                <label for="notes">Notes</label>
                <textarea name="notes" 
                          id="notes"
                          rows="4"><%= prefilledData ? prefilledData.notes : '' %></textarea>
            </div>
        </div>

        <div class="form-footer">
            <a href="/records" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary">Add Record</button>
        </div>
    </form>
</div>

<script>
const imageUrl = document.getElementById('imageUrl');
const imagePreview = document.querySelector('#imagePreview img');

imageUrl.addEventListener('input', function() {
    const url = this.value;
    imagePreview.src = url || '/images/default-album.png';
});
</script>

<%- include('../partials/footer.ejs') %>